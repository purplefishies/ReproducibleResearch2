---
title: "Investigating the patterns of damage from various natural disasters"
author: "Jimi Damon"
date: "06/21/2015"
output: html_document
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
url:
  lib: ../../librariesNew
  assets: ../../assets
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='./figure/',
                     warning=FALSE, message=FALSE)
```


```{r,echo=TRUE,results='asis'}
library(dplyr)
library(ggplot2)
library(lubridate)
```


# Syopsis
With global scientific consensus corroborating the direct causal relationship between mankind's consumption of fossil fuels and global climate change, it is ever more important that Government resources be allocated to handle the new weather related disasters that are spawned by this changes of the Earth's climate.  In this dossier , we will be investigating ways to assess which weather related 

This analyis will involve using the storm data provided by the national weather service between the years of 1950 and 2011. The assumptions for this analyis based on the years of coverage 


```{r,echo=TRUE,results='asis'}
dat <- read.csv("./stormdata.csv")
ddat <- tbl_df( dat )
```


# Data Processing

We need to get our data into a format that avoids redudancy and overcounting. I decided to group the types of weather related disasers according to the following rules. 

Tornados according to the Fujita scale (F-scale)
  0,1,2,3,4,5
Hurricaines that do not involve tornadoes or Hail
Hail of any type that do not include tornadoes
Thunderstorm / High Wind related but no Tornadoes, Hurricanes or Hail related
Cold without Snow and Ice related injuries and deaths
Heat (without dust)
Flood 
Ice and Snow but discounting Cold related effects
Volcano
Dust without heat 


The process for creating the filters was performed in an interative way so as to ensure that data wasn't counted twice to a given category. The first data types were relatively easy such as Tornadoes, but when diving down into a more selective chategory like HAIl, it was important to perform appropriate filters that would select out chategories that were already considered such as Tornadoes and Hurricaines that tend to produce Hail but whose chategory would be a superset of the damage chategory being analyzed.

For instance, a typical encounter would be to first filter the events that matched "wind", and then reduce that set iterarively by inspecting the unique set of events that matched wind **and then exclude** events that had been already captured by a previous grouping.



We calculate each type of event as follows
```{r,echo=TRUE}
length(ddat$F)
```

```{r,echo=TRUE}
capture_stats <- function() {
    setNames(list(~mean(FATALITIES,rm.na=TRUE),
                  ~mean(PROPDMG,rm.na=TRUE),
                  ~mean(PROPDMG,rm.na=TRUE),
                  ~mean(CROPDMG,rm.na=TRUE),
                  ~n()
                  ),
             c("ave_fatalities","ave_injuries","ave_propdmg","ave_cropdmg","nevents")
             )  
}
```


Define the different types of filters for extracting the pertinent information

## Filters

```{r,echo=FALSE}
tornado_filter <- ~!is.na(F)
hurricane_filter <- ~grepl(".*hur[r]?i.*", EVTYPE,perl=T,ignore.case=T )
hail_filter <- ~grepl(".*hail.*", EVTYPE,perl=T,ignore.case=T) & !grepl(".*tornado.*",  EVTYPE,perl=T,ignore.case=T)
wind_tstorm_filter <- ~grepl(".*(wind|thunder|tstm).*", EVTYPE,perl=T,ignore.case=T) &
    !grepl(".*tornado.*",  EVTYPE,perl=T,ignore.case=T) & 
    !grepl(".*hurricane.*",  EVTYPE,perl=T,ignore.case=T) &
    !grepl(".*(cold|chill).*",  EVTYPE,perl=T,ignore.case=T) &
    !grepl(".*(flood).*",  EVTYPE,perl=T,ignore.case=T)

cold_noicesnow_filter <- ~grepl(".*(cold|chill).*", EVTYPE,perl=T,ignore.case=T) &
    !grepl(".*(flood).*",  EVTYPE,perl=T,ignore.case=T) &
    !grepl(".*(snow|ice).*", EVTYPE,perl=T,ignore.case=T)

icesnow_filter <- ~grepl(".*(ice|snow).*", EVTYPE,perl=T,ignore.case=T) & 
  !grepl(".*(flood).*",  EVTYPE,perl=T,ignore.case=T) &
	!grepl(".*(chill|snow).*",EVTYPE,perl=T,ignore.case=T) &
	!grepl(".*(wind).*",EVTYPE,perl=T,ignore.case=T)


head_filter <- ~grepl(".*(heat).*", EVTYPE,perl=T,ignore.case=T)

flood_filter <- ~grepl(".*(flood).*", EVTYPE,perl=T,ignore.case=T) &
    !grepl(".*(thunder|tstm).*",  EVTYPE,perl=T,ignore.case=T) & 
    !grepl(".*(wind).*",  EVTYPE,perl=T,ignore.case=T) & 
    !grepl(".*(snow).*",  EVTYPE,perl=T,ignore.case=T) 

volcano_filter <- ~grepl(".*volc.*", EVTYPE,perl=T,ignore.case=T)

dust_filter <- ~grepl(".*dust.*", EVTYPE,perl=T,ignore.case=T) &
    !grepl(".*(wind).*",EVTYPE,perl=T,ignore.case=T)
```

### Tornadoes

```{r,echo=TRUE}
tornadoes <- ddat %>%
    filter_( .dots=tornado_filter ) %>%
    group_by(F) %>%
    mutate( EVTYPE=ifelse(!is.na(F),paste("TORNADO_F",as.character(F),sep=""),"BLAH"))  %>%
    group_by( EVTYPE ) %>% 
    summarise_( .dots=capture_stats() )
knitr::kable(tornadoes)
```


### Hurricanes

```{r,echo=TRUE,}
hurricane <- ddat %>%
    filter_( .dots=hurricane_filter ) %>%
    mutate( EVTYPE="HURRICANE") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )
```

### Hail only effects

```{r,echo=TRUE}
hail <- ddat %>%
    filter_( .dots=hail_filter ) %>%
    mutate( EVTYPE="HAIL") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )
```

### Thunderstorm and Wind

```{r,echo=TRUE}
wind_tstorm <- ddat %>%
    filter_( .dots=wind_tstorm_filter ) %>%
    mutate( EVTYPE="WIND_OR_TSTM") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )
```

### Cold Withouth Snow or Ice

```{r,echo=TRUE}
cold_noicesnow <- ddat %>%
    filter_( .dots=cold_noicesnow_filter ) %>%
    mutate( EVTYPE="COLD") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )
```

### Heat 

```{r,echo=TRUE}
heat <- ddat %>%
    filter_( .dots=head_filter ) %>%
    mutate( EVTYPE="HEAT") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )

```

### Flood

```{r,echo=TRUE}
flood <- ddat %>%
    filter_( .dots=flood_filter ) %>%
    mutate( EVTYPE="FLOOD") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )

```

### Ice and Snow without wind effects

```{r,echo=TRUE}
icesnow <- ddat %>%
    filter_( .dots=icesnow_filter ) %>%
    mutate( EVTYPE="ICE_SNOW") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )
```

### Volcano related 

```{r,echo=TRUE}
volcano <- ddat %>%
    filter_( .dots=volcano_filter ) %>% 
    mutate( EVTYPE="VOLCANO") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )
```

### Dust related

```{r,echo=TRUE}
dust <- ddat %>%
    filter_( .dots=dust_filter ) %>% 
    mutate( EVTYPE="DUST") %>%
    group_by(EVTYPE) %>%
    summarise_( .dots=capture_stats() )
```

After each factor is isolated, I combine these into a new data table for analysis

```{r,echo=TRUE}
all_data <- Reduce( function(x,y){ merge(x,y,all=T) }, list(tornadoes, hurricane, hail, wind_tstorm, cold_noicesnow, heat, flood, icesnow, volcano, dust ) )
  
knitr::kable(all_data)
```





Clearly, from this table, we find that the tornadoes of the variety F4 and F5 constitute the disasters with the 
##Will be investigating which types of events are most harmful to human health

which parameters of the dataset indicate deaths / injuries




Which events have the largest economic consequences





# Results

Something goes in here too

# Conclusion 

Something here too
